@using Journal.Repository
@using Journal.Services
@attribute [Route(Home.Route)]

@inject IDialogService DialogService
@inject StreaksRepository StreaksRepository
@inject NavigationManager NavigationManager
@inject AuthService AuthService

<!-- Hero Section -->
<MudContainer MaxWidth="MaxWidth.Large" Class="mt-8">
    
    <!-- Welcome Banner -->
    <MudPaper Elevation="0" Class="pa-8 mb-6" 
              Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px;">
        <MudStack Spacing="2">
            <MudText Typo="Typo.h3" Style="color: white; font-weight: 600;">
                Welcome back, @AuthService.CurrentUser.Username 👋
            </MudText>
            <MudText Typo="Typo.h6" Style="color: rgba(255,255,255,0.9);">
                @GetGreeting() How are you feeling today?
            </MudText>
            <MudButton Variant="Variant.Filled" 
                       Size="Size.Large"
                       StartIcon="@Icons.Material.Filled.Edit"
                       OnClick="@(() => NavigationManager.NavigateTo("/journal"))"
                       Style="width: fit-content; margin-top: 16px; font-weight: 600; color: #f7f7f7">
                Start Writing
            </MudButton>
        </MudStack>
    </MudPaper>

    <MudGrid Spacing="4">
        
        <!-- Quick Stats Cards -->
        <!-- Quick Stats Cards -->
<MudItem xs="12" sm="6" md="3">
    <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 16px; text-align: center; min-height: 140px; display: flex; flex-direction: column; justify-content: center;">
        <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-weight: bold;">
            @totalEntries
        </MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            Total Entries
        </MudText>
    </MudPaper>
</MudItem>

<MudItem xs="12" sm="6" md="3">
    <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 16px; text-align: center; min-height: 140px; display: flex; flex-direction: column; justify-content: center;">
        <MudStack AlignItems="AlignItems.Center" Spacing="1">
            <MudIcon Icon="@Icons.Material.Filled.LocalFireDepartment" 
                     Color="Color.Warning" 
                     Style="font-size: 35px;" />
            <MudText Typo="Typo.h4" Style="font-weight: bold;">
                @currentStreak
            </MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary">
                Day Streak
            </MudText>
        </MudStack>
    </MudPaper>
</MudItem>

<MudItem xs="12" sm="6" md="3">
    <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 16px; text-align: center; min-height: 140px; display: flex; flex-direction: column; justify-content: center;">
        <MudText Typo="Typo.h3" Style="font-weight: bold;">
            😊
        </MudText>
        <MudText Typo="Typo.body1" Style="font-weight: 500;">
            @dominantMood
        </MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            This Week
        </MudText>
    </MudPaper>
</MudItem>

<MudItem xs="12" sm="6" md="3">
    <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 16px; text-align: center; min-height: 140px; display: flex; flex-direction: column; justify-content: center;">
        <MudText Typo="Typo.h3" Color="Color.Success" Style="font-weight: bold;">
            @thisMonthCount
        </MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            This Month
        </MudText>
    </MudPaper>
</MudItem>

        <!-- Recent Entries Timeline -->
        <MudItem xs="12" md="8">
            <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 16px;">
                <MudStack Row Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
                    <MudText Typo="Typo.h6" Style="font-weight: 600;">
                        📖 Recent Entries
                    </MudText>
                    <MudButton Variant="Variant.Text" 
                               Color="Color.Primary"
                               OnClick="@(() => NavigationManager.NavigateTo("/entries"))">
                        View All
                    </MudButton>
                </MudStack>

                @if (!recentEntries.Any())
                {
                    <MudStack AlignItems="AlignItems.Center" Spacing="3" Class="py-8">
                        <MudIcon Icon="@Icons.Material.Outlined.MenuBook" 
                                 Style="font-size: 80px; color: #ddd;" />
                        <MudText Typo="Typo.h6" Color="Color.Secondary">
                            No entries yet
                        </MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Style="text-align: center;">
                            Start your journaling journey today.<br/>Your thoughts deserve a home.
                        </MudText>
                        <MudButton Variant="Variant.Filled" 
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.Add"
                                   OnClick="@(() => NavigationManager.NavigateTo("/journal"))">
                            Write First Entry
                        </MudButton>
                    </MudStack>
                }
                else
                {
                    <MudTimeline TimelineOrientation="TimelineOrientation.Vertical" TimelinePosition="TimelinePosition.Start">
                        @foreach (var entry in recentEntries.Take(5))
                        {
                            <MudTimelineItem Color="Color.Primary" Size="Size.Small">
                                <ItemContent>
                                    <MudCard Elevation="0" Class="mb-2" Style="border: 1px solid #e0e0e0;">
                                        <MudCardContent>
                                            <MudStack Spacing="2">
                                                <MudText Typo="Typo.body2" Color="Color.Secondary">
                                                    @entry.Date.ToString("MMMM dd, yyyy")
                                                </MudText>
                                                <MudText Typo="Typo.body1" Style="line-height: 1.6;">
                                                    @GetEntryPreview(entry.Content)
                                                </MudText>
                                                <MudStack Row Wrap="Wrap.Wrap" Spacing="1">
                                                    @foreach (var mood in entry.Moods.Take(3))
                                                    {
                                                        <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Outlined">
                                                            @mood
                                                        </MudChip>
                                                    }
                                                </MudStack>
                                            </MudStack>
                                        </MudCardContent>
                                    </MudCard>
                                </ItemContent>
                            </MudTimelineItem>
                        }
                    </MudTimeline>
                }
            </MudPaper>
        </MudItem>

        <!-- Right Sidebar -->
        <MudItem xs="12" md="4">
            <MudStack Spacing="4">
                
                <!-- Mood Calendar -->
                <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 16px;">
                    <MudText Typo="Typo.h6" Class="mb-3" Style="font-weight: 600;">
                        😊 Mood Calendar
                    </MudText>
                    <MudCalendar Date="selectedDate"
                                 DateChanged="@((DateTime date) => selectedDate = date)"
                                 ReadOnly="true"
                                 Class="mood-calendar" />
                    <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mt-2">
                        Green = Entries logged
                    </MudText>
                </MudPaper>

                <!-- Daily Inspiration -->
                <MudPaper Elevation="2" Class="pa-6"
                    Style="border-radius: 16px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <MudIcon Icon="@Icons.Material.Filled.AutoAwesome"
                        Style="color: rgba(255,255,255,0.9); font-size: 32px;" Class="mb-3" />
                    <MudText Typo="Typo.body1" Style="color: white; font-style: italic; line-height: 1.6;" Class="mb-3">
                        "@dailyQuote"
                    </MudText>
                    <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.95); font-weight: 500;">
                        — @quoteAuthor
                    </MudText>
                </MudPaper>

                <!-- Writing Prompts -->
                <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 16px;">
                    <MudText Typo="Typo.h6" Class="mb-3" Style="font-weight: 600;">
                        ✨ Writing Prompt
                    </MudText>
                    <MudText Typo="Typo.body2" Class="mb-3" Style="line-height: 1.6;">
                        @writingPrompt
                    </MudText>
                    <MudButton Variant="Variant.Text" 
                               Color="Color.Primary"
                               Size="Size.Small"
                               OnClick="LoadNewPrompt">
                        New Prompt
                    </MudButton>
                </MudPaper>

            </MudStack>
        </MudItem>

    </MudGrid>
</MudContainer>