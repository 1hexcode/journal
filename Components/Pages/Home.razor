@using Journal.Repository
@attribute [Route(Home.Route)]

@inject IDialogService DialogService
@inject StreaksRepository StreaksRepository
@inject NavigationManager NavigationManager

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-8">
    <!-- Welcome Hero Section -->
    <MudPaper Elevation="0" Class="pa-8 mb-6"
        Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px;">
        <MudGrid>
            <MudItem xs="12" md="8">
                <MudText Typo="Typo.h3" Style="color: white; font-weight: 600;" Class="mb-3">
                    Welcome back, @GetGreeting()
                </MudText>
                <MudText Typo="Typo.h6" Style="color: rgba(255,255,255,0.9);" Class="mb-4">
                    How are you feeling today? Take a moment to reflect and track your journey.
                </MudText>
                <MudButton Variant="Variant.Filled"  Style="color: white" Size="Size.Large" Href="/journal"
                    StartIcon="@Icons.Material.Filled.Create" Class="mt-2">
                    Write in Journal
                </MudButton>
            </MudItem>
            <MudItem xs="12" md="4" Class="d-flex align-center justify-center">
                <MudIcon Icon="@Icons.Material.Filled.SelfImprovement"
                    Style="font-size: 120px; color: rgba(255,255,255,0.3);" />
            </MudItem>
        </MudGrid>
    </MudPaper>

    <!-- Quick Stats -->
    <MudGrid Class="mb-6">
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 12px;">
                <MudStack Row="false" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.CalendarToday" Color="Color.Primary" Size="Size.Large" />
                    <MudText Typo="Typo.h4" Class="font-weight-bold">@totalEntries</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Total Entries</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 12px;">
                <MudStack Row="false" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.LocalFireDepartment" Color="Color.Warning"
                        Size="Size.Large" />
                    <MudText Typo="Typo.h4" Class="font-weight-bold">@currentStreak</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Day Streak</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 12px;">
                <MudStack Row="false" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.EventAvailable" Color="Color.Success" Size="Size.Large" />
                    <MudText Typo="Typo.h4" Class="font-weight-bold">@thisMonth</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">This Month</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Elevation="2" Class="pa-4" Style="border-radius: 12px;">
                <MudStack Row="false" Spacing="2">
                    <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Color="Color.Info" Size="Size.Large" />
                    <MudText Typo="Typo.h4" Class="font-weight-bold">@avgWords</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Avg Words</MudText>
                </MudStack>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudGrid>
        <!-- Recent Journal Entries -->
        <MudItem xs="12" lg="8">
            <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 12px;">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
                    <MudText Typo="Typo.h5" Class="font-weight-bold">Recent Entries</MudText>
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/journal"
                        EndIcon="@Icons.Material.Filled.ArrowForward">
                        View All
                    </MudButton>
                </MudStack>

                @if (recentEntries.Any())
                {
                    <MudStack Row="false" Spacing="3">
                        @foreach (var entry in recentEntries.Take(3))
                        {
                            <MudPaper Elevation="0" Class="pa-4"
                                Style="border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer;"
                                @onclick="@(() => NavigateToEntry(entry.Date))">
                                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Start">
                                    <MudStack Row="false" Spacing="1" Style="flex: 1;">
                                        <MudText Typo="Typo.h6" Class="font-weight-bold">@entry.Title</MudText>
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">
                                            @entry.Date.ToString("MMMM dd, yyyy") · @entry.WordCount words
                                        </MudText>
                                        <MudText Typo="Typo.body2" Class="mt-2" Style="color: #666;">
                                            @GetPreview(entry.Content)
                                        </MudText>
                                    </MudStack>
                                    <MudIcon Icon="@GetMoodIcon(entry.Mood)" Color="@GetMoodColor(entry.Mood)"
                                        Size="Size.Large" />
                                </MudStack>
                            </MudPaper>
                        }
                    </MudStack>
                }
                else
                {
                    <MudStack AlignItems="AlignItems.Center" Class="pa-8">
                        <MudIcon Icon="@Icons.Material.Filled.MenuBook" Style="font-size: 80px; color: #e0e0e0;" />
                        <MudText Typo="Typo.h6" Color="Color.Secondary" Class="mt-4">
                            No entries yet
                        </MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Class="mt-2">
                            Start your journaling journey today
                        </MudText>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/journal" Class="mt-4">
                            Create First Entry
                        </MudButton>
                    </MudStack>
                }
            </MudPaper>
        </MudItem>

        <!-- Mood Overview & Quick Actions -->
        <MudItem xs="12" lg="4">
            <MudStack Row="false" Spacing="4">
                <!-- Today's Mood Check -->
                <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 12px;">
                    <MudText Typo="Typo.h6" Class="font-weight-bold mb-4">How are you feeling?</MudText>
                    <MudStack Row="false" Spacing="3">
                        @foreach (var mood in moods)
                        {
                            <MudButton Variant="@(selectedMood == mood.Value ? Variant.Filled : Variant.Outlined)"
                                Color="@mood.Color" FullWidth="true" StartIcon="@mood.Icon"
                                OnClick="@(() => SelectMood(mood.Value))" Size="Size.Large"
                                Style="justify-content: flex-start;">
                                @mood.Label
                            </MudButton>
                        }
                    </MudStack>
                </MudPaper>

                <!-- Quick Actions -->
                <MudPaper Elevation="2" Class="pa-6" Style="border-radius: 12px;">
                    <MudText Typo="Typo.h6" Class="font-weight-bold mb-4">Quick Actions</MudText>
                    <MudStack Row="false" Spacing="2">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" FullWidth="true"
                            StartIcon="@Icons.Material.Filled.Create" Href="/journal"
                            Style="justify-content: flex-start;">
                            New Entry
                        </MudButton>
                        <MudButton Variant="Variant.Text" Color="Color.Primary" FullWidth="true"
                            StartIcon="@Icons.Material.Filled.Insights" Style="justify-content: flex-start;">
                            View Insights
                        </MudButton>
                        <MudButton Variant="Variant.Text" Color="Color.Primary" FullWidth="true"
                            StartIcon="@Icons.Material.Filled.Search" Href="/journal"
                            Style="justify-content: flex-start;">
                            Search Entries
                        </MudButton>
                        <MudDivider Class="my-2" />
                        <MudButton Variant="Variant.Text" Color="Color.Secondary" FullWidth="true"
                            StartIcon="@Icons.Material.Filled.Settings" Style="justify-content: flex-start;">
                            Settings
                        </MudButton>
                    </MudStack>
                </MudPaper>

                <!-- Inspirational Quote -->
                <MudPaper Elevation="2" Class="pa-6"
                    Style="border-radius: 12px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <MudIcon Icon="@Icons.Material.Filled.FormatQuote"
                        Style="color: rgba(255,255,255,0.5); font-size: 40px;" Class="mb-2" />
                    <MudText Typo="Typo.body1" Style="color: white; font-style: italic;" Class="mb-3">
                        "@dailyQuote"
                    </MudText>
                    <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.8);">
                        — @quoteAuthor
                    </MudText>
                </MudPaper>
            </MudStack>
        </MudItem>
    </MudGrid>
</MudContainer>
