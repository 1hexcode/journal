@attribute [Route(JournalPage.Route)]

@inject IJSRuntime JS
@inject IDialogService DialogService


<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-8">

    <MudGrid Spacing="4">

        <!-- LEFT : JOURNAL EDITOR -->
        <MudItem xs="12" md="8">

            <MudPaper Elevation="6" Class="pa-6 journal-card">

                <MudText Typo="Typo.h4" GutterBottom>
                    üìù Daily Journal
                </MudText>

                <MudDivider Class="mb-4" />

                <!-- Date Selection -->
                <MudDatePicker Label="Journal Date"
                               Date="SelectedDate"
                               DateChanged="OnDateChanged"
                               PickerVariant="PickerVariant.Inline"
                               Class="mb-4" />

                <!-- Mood Selection -->
                <MudText Typo="Typo.subtitle1" Class="mt-2 mb-1">
                    How are you feeling today?
                </MudText>

                <MudChipSet T="string"
                            MultiSelection="true"
                            CheckMark="true"
                            SelectedValues="SelectedMoods"
                            SelectedValuesChanged="OnMoodsChanged">

                    @foreach (var mood in AvailableMoods)
                    {
                        <MudChip Value="@mood"
                                 Color="GetMoodColor(mood)"
                                 Variant="Variant.Filled">
                            @mood
                        </MudChip>
                    }
                </MudChipSet>

                <!-- Add Custom Mood -->
                <MudStack Row Spacing="2" Class="mt-3">
                    <MudTextField @bind-Value="NewMood"
                                  Placeholder="Add a new feeling..."
                                  Variant="Variant.Outlined"
                                  Dense />
                    <MudButton Color="Color.Primary"
                               Variant="Variant.Filled"
                               OnClick="AddMood">
                        Add
                    </MudButton>
                </MudStack>

                <MudDivider Class="my-5" />

                <!-- Rich Text Editor -->
                <MudText Typo="Typo.subtitle1" Class="mb-2">
                    Write your thoughts
                </MudText>

                <div id="editor" class="journal-editor"></div>

                <!-- Actions -->
                <MudStack Row Spacing="2" Justify="Justify.SpaceBetween" Class="mt-5">

                    <MudStack Row Spacing="2">
                        <MudButton Color="Color.Primary"
                                   Variant="Variant.Filled"
                                   OnClick="SaveWithConfirmation">
                            üíæ Save Entry
                        </MudButton>

                        <MudButton Color="Color.Secondary"
                                   Variant="Variant.Outlined"
                                   OnClick="Clear">
                            üßπ Clear
                        </MudButton>
                    </MudStack>

                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        Stored locally (in-memory)
                    </MudText>

                </MudStack>


            </MudPaper>
            <!-- All Entries HTML BELOW the journal card -->
            <MudPaper Elevation="2" Class="pa-4 mt-4 all-entries-paper">
                <MudText Typo="Typo.h6" GutterBottom>
                    üìÑ All Entries (HTML)
                </MudText>

                <MudPaper Class="pa-3" Style="overflow:auto; max-height:300px;">
                    <pre>@GetAllEntriesHtml()</pre>
                </MudPaper>
            </MudPaper>

        </MudItem>


        <!-- RIGHT : RECENT ENTRIES -->
        <MudItem xs="12" md="4">

            <MudPaper Elevation="4" Class="pa-4 recent-card">

                <MudText Typo="Typo.h6" GutterBottom>
                    üìö Recent Entries
                </MudText>

                <MudDivider Class="mb-3" />

                @if (!RecentEntries.Any())
                {
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        No entries yet. Start writing üå±
                    </MudText>
                }
                else
                {
                    <MudList T="string" Dense="true">
                        @foreach (var entry in RecentEntries.OrderByDescending(e => e.Date))
                        {
                            <MudListItem T="string">
                                <MudStack Spacing="1">

                                    <MudText Typo="Typo.subtitle2">
                                        @entry.Date.ToString("dd MMM yyyy")
                                    </MudText>

                                    <MudStack Row Wrap="Wrap.Wrap">
                                        @foreach (var mood in entry.Moods)
                                        {
                                            <MudChip T="string" Size="Size.Small"
                                                     Color="Color.Primary"
                                                     Variant="Variant.Outlined">
                                                @mood
                                            </MudChip>
                                        }
                                    </MudStack>

                                </MudStack>
                            </MudListItem>
                        }
                    </MudList>
                }

            </MudPaper>

        </MudItem>

    </MudGrid>

</MudContainer>